<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<link rel="stylesheet" data-name="vs/editor/editor.main" href="./min/vs/editor/editor.main.css" />
	<style>
		html, body
		{
			background-color: #1E1E1E;
			height: 100%;
			width: 100%;
			margin: 0;
		}

		#container
		{
			height: 100%;
			width: 100%;
		}
	</style>
</head>
<body>
	<div id="container"></div>
	<script src="./min/vs/loader.js"></script>
	<script>
		require.config({ paths: { 'vs': './min/vs' } });
	</script>
	<script src="./min/vs/editor/editor.main.nls.js"></script>
	<script src="./min/vs/editor/editor.main.js"></script>
	<script>
		const bridge = chrome.webview.hostObjects.bridge;
		var editor = monaco.editor.create(document.getElementById('container'),
			{
				value: "from(bucket: \"events\")\r\n" +
					"\t|> range(start: 2023-11-03T00:00:00Z, stop: 2023-11-04T00:00:00Z)\r\n" +
					"\t|> filter(fn: (r) => r[\"code\"] =~ /[IE]_SPE_03F2/)\r\n" +
					"\t|> filter(fn: (r) => r[\"_field\"] == \"p-holder\" or r[\"_field\"] == \"p-mafm\" or r[\"_field\"] == \"p-sniffle_target\" or r[\"_field\"] == \"description\")\r\n" +
					"\t|> filter(fn: (r) => r[\"ssindex\"] == \"0\")\r\n",
				language: 'flux',
				automaticLayout: true,
				theme: "vs-dark"
			});
		var model = editor.getModel();
		model.onDidChangeContent(() => { bridge.TextChanged(model.getValue()); })
		bridge.TextChanged(model.getValue());
		bridge.OnDisplayErrorMarker((fromline, toline, fromcol, tocol, errormessage) => { DisplayErrorMarker(fromline, toline, fromcol, tocol, errormessage); })
		bridge.Log("Loaded!");
	</script>
	<script>
		function DisplayErrorMarker(fromline, toline, fromcol, tocol, errormessage)
		{
			try
			{
				const markers = [{
					message: errormessage,
					severity: monaco.MarkerSeverity.Error,
					startLineNumber: fromline,
					startColumn: fromcol,
					endLineNumber: toline,
					endColumn: tocol,
				}];
				monaco.editor.setModelMarkers(model, "owner", markers);
			}
			catch (err)
			{
				bridge.Log("DisplayErrorMarker failed: " + err.message)
			}
		}

		function ClearErrorMarker()
		{
			try
			{
				const markers = [];
				monaco.editor.setModelMarkers(model, "owner", markers);
			}
			catch (err)
			{
				bridge.Log("ClearErrorMarker failed: " + err.message)
			}
		}
	</script>
</body>
</html>
